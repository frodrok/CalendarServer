@(user: model.User, groups: Seq[model.Group])(eventForm: Form[addEventFormData])(implicit messages: Messages)

@import helper._

<head>
    <link href='@routes.Assets.versioned("stylesheets/fullcalendar.css")' rel="stylesheet">
    <script src='@routes.Assets.versioned("javascripts/lib/moment.min.js")'></script>
    <script src='@routes.Assets.versioned("javascripts/lib/jquery-3.0.0.min.js")'></script>
    <script src='@routes.Assets.versioned("javascripts/lib/fullcalendar.min.js")'></script>
    <script>

            function setupCalendar(events) {
                if (events.length < 1) {
                    console.log("no events recieved");
                } else {
                    console.log("setting up calendar with these events: ");
                    events.forEach(console.log.bind(console));
                }

                $('#calendar').fullCalendar({
                    header: {
                        left: 'prev,next today',
                        center: 'title',
                        right: 'month,basicWeek,basicDay'
                    },
                    defaultDate: '2016-08-01',
                    editable: false,
                    eventLimit: true,
                    events: events
                });
            }

            $(document).ready(function() {

                console.log(@user.id);

                $.getJSON("http://localhost:9000/user/" + @user.id + "/events").done(function(data) {
                    var cleanedEvents = data.map(function(e) {
                       return {title: e.eventName, start: e.from.substring(0, 19)}
                   });

                    setupCalendar(cleanedEvents);

                }).fail(function(failure) {
                    console.log("get events failure: [" + failure.status + "]: " + failure.responseText);
                });

            });

    </script>
    <style>

    body {
        margin: 40px 10px;
        padding: 0;
        font-family: "Lucida Grande",Helvetica,Arial,Verdana,sans-serif;
        font-size: 14px;
    }

    #calendar {
        /* max-width: 1000px; */
        margin: 0 auto;
    }



    </style>
</head>

<div id="top">
    <p><span style="font-size: 2em;">user page: @user.username</span> [<a href="/user/logout">Log out</a>]</p>
</div>

<div id="setgroup">
    @* <h1>Set your group</h1> @if(user.groupId.isDefined) {
        <span>- current group: @user.groupId.get</span>
    } *@

    <p>Set your group @if(user.groupId.isDefined) {
        - current group: @user.groupId.get }
    </p>

    @form(routes.UserController.setGroup) {
        <select name="group">
            @groups.map { flat => <option value='@flat.id'>@flat.id - @flat.groupName</option> }
        </select>
        <input type="submit" value="Set group" />
    }
</div>

    <div id="eventandcalendar">
    @* <div id="add-event">
        <h1>Add event</h1>

        @form(action = routes.UserController.addEvent) {

            @inputText(eventForm("eventName"))
            @inputDate(eventForm("from"))
            @inputText(eventForm("fromClock"))
            @inputDate(eventForm("to"))
            @inputText(eventForm("toClock"))
            @* @inputText(eventForm("groupId"))

            <input type="hidden" id="groupId" name="groupId" value='@user.groupId'>

            @* @inputPassword(eventForm("password"))
            @checkbox(registerForm("isadmin"))
            @inputText(registerForm("groupid"))

            <input type="submit" value="add event" />
        }

    </div> *@

    <div id="calendar"></div>

    </div>
